/*
 * base.js
 * 1. handle base template
 * 2. handle whole front-end templates routing
 * 
 * */
'use strict';
var index_page_app, device;
(function() {
	// Angular.js
	// declare app level module which depends on filters, and services, and
	// modify $interpolateProvider to avoid the conflict with jinja2' symbol
	var injected_module = [];
	if (is_admin){
		injected_module = [ 'angular-responsive',
		        			'ui.router', 'myGpsDataDirective',
		        			'myIndexAdminImagesUploadDirective' ];
	}
	else{
		injected_module = [ 'angular-responsive',
		        			'ui.router', 'myGpsDataDirective' ];
	}
	index_page_app = angular.module('index_page_app', injected_module , function(
			$interpolateProvider) {
		$interpolateProvider.startSymbol('[[');
		$interpolateProvider.endSymbol(']]');
	});

	// global values
	index_page_app.value('GLOBAL_VALUES', {
		EMAIL : 'gogistics@gogistics-tw.com',
		URL_UPLOAD_IMAGE_TO_BLOB : data_backend.upload_url,
	});

	// app-routing configuration
	index_page_app.config(function(responsiveHelperProvider, $stateProvider,
			$urlRouterProvider) {
		// templates dispatcher which redirect visitors to appropriate
		// templates;
		// currently, there are desktop and mobile versions
		device = 'desktop';
		var responsiveHelper = responsiveHelperProvider.$get();
		if (responsiveHelper.isMobile()) {
			device = 'mobile';
		} else if (responsiveHelper.isTablet()) {
			device = 'tablet';
		}

		// nested templates and routing
		$stateProvider.state('home', {
			templateUrl : '/ng_templates/my_ng_template_base.html',
		}).state('index_page', {
			parent : 'home',
			templateUrl : '/ng_templates/' + device + '/index.html',
			controller : 'indexPageDispatchCtrl'
		}).state(
				'index_introduction',
				{
					url : '/index_introduction',
					parent : 'index_page',
					templateUrl : '/ng_templates/' + device
							+ '/index_introduction.html',
				}).state(
				'index_data_analysis',
				{
					url : '/index_data_analysis',
					parent : 'index_page',
					templateUrl : '/ng_templates/' + device
							+ '/index_data_analysis.html',
				});

		$urlRouterProvider.otherwise('/index_introduction'); // for defualt
																// state
																// routing; for
																// current
																// routing
																// mechanism,
																// it's not
																// necessary

	});

	/* controllers */
	// for routing to default content on index page
	var indexPageDispatchController = function($state, $scope, GLOBAL_VALUES) {
		$scope.email = GLOBAL_VALUES.EMAIL;
		console.log($state.current.name);

		if ($state.current.name !== 'index_introduction') {
			$state.transitionTo('index_introduction');
		}
	}
	indexPageDispatchController.$inject = [ '$state', '$scope', 'GLOBAL_VALUES' ];

	// page controllers
	var myIndexController = function($scope, GLOBAL_VALUES) {
		$scope.email = GLOBAL_VALUES.EMAIL;

		$scope.select_topic = function(section) {
			$scope.selected = section;
		}

		$scope.is_selected = function(section) {
			return ($scope.selected === section);
		}

		// init selected topic
		$scope.select_topic('index_introduction');
	}
	myIndexController.$inject = [ '$scope', 'GLOBAL_VALUES' ];

	index_page_app.controller('indexPageDispatchCtrl',
			indexPageDispatchController).controller('myIndexCtrl',
			myIndexController);

	// ng-services of index_data_analysis
	var indexDataAnalysisService = function($http, GLOBAL_VALUES) {
		// upload imgs
		this.upload_imgs = function(arg_data) {
			alert('test');
			console.log(arg_data);
		}

		// download imgs
		this.dowload_imgs_detail = function() {
			var data = {
				'key' : 'ergr425t45gSVDTtrhrthrethT56h'
			};
			return $http.post('/data_retrieving/download_img', data, {
				withCredentials : true,
				headers : {
					'Content-Type' : undefined
				},
				transformRequest : angular.identity
			})
		};
	}
	indexDataAnalysisService.$inject = [ '$http', 'GLOBAL_VALUES' ];
	index_page_app.service('myIndexDataAnalysisService', indexDataAnalysisService);

	
	
	// index (not done)
	var indexImagesInformationUploadController = function (){
		
	}
	
	
	/* index page images list controller; better to categorize lists */
	var indexImagesDetailListController = function(myIndexDataAnalysisService,GLOBAL_VALUES, $scope) {
		// upload images information
		$scope.images_data_to_upload = 'data analysis';
		
		// upload images
		var upload_img_to_blobstore = function() {
			myIndexDataAnalysisService.upload_imgs('hello data analysis');
		};
		this.upload_img_to_blobstore = upload_img_to_blobstore;
		
		
		// download images details
		var current_obj = this;
		current_obj.imgs_detail = [];
		
		var download_imgs_detail = function() {
			myIndexDataAnalysisService.dowload_imgs_detail().success(function(response) {
				console.log(JSON.stringify(response,2,2));
				current_obj.imgs_detail = response.imgs_detail_entities;
			}).error(function(response) {
				console.log('fail to download images detail');
			});
		}
		download_imgs_detail();
		console.log(JSON.stringify(current_obj.imgs_detail,2,2));
		
		// ng-pagination
		$scope.currentPage = 1;
		$scope.pageSize = 1;
		// end of ng-pagination
	}
	indexImagesDetailListController.$inject = [ 'myIndexDataAnalysisService',
			'GLOBAL_VALUES', '$scope' ];
	index_page_app.controller('indexImagesDetailListCtrl', indexImagesDetailListController);
	
	
	// pagination controller for images list
	var indexImagesDetailListPaginationController = function($scope) {
		$scope.pageChangeHandler = function(num) {
			console.log('page changed to ' + num);
		};
	}
	indexImagesDetailListPaginationController.$inject = ['$scope'];
	index_page_app.controller('indexImagesDetailListPaginationCtrl', indexImagesDetailListPaginationController);
	/* end of index page images list controller */
	
	
	/* index page data visualization chart */
	var indexDataAnalysisListController = function(myIndexDataAnalysisService,GLOBAL_VALUES, $scope){
		// set data array
		var current_obj = this;
		current_obj.data_ary = [];
		
		$scope.currentPage = 2;
		$scope.pageSize = 2;
	}
	indexDataAnalysisListController.$inject = ['myIndexDataAnalysisService',
			'GLOBAL_VALUES', '$scope'];
	index_page_app.controller('indexDataAnalysisListCtrl', indexDataAnalysisListController);
	
	// pagination controller for images list
	var indexDataAnalysisListPaginationController = function($scope) {
		$scope.pageChangeHandler = function(num) {
			console.log('page changed to ' + num);
		};
	}
	indexDataAnalysisListPaginationController.$inject = ['$scope'];
	index_page_app.controller('indexImagesDetailListPaginationCtrl', indexDataAnalysisListPaginationController);
	/* end of index page data visualization chart */
	
	
	
	
	/* JQuery */
})();