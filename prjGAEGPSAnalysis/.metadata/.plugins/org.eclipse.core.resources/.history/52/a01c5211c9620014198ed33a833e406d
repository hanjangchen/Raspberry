/*
 * base.js
 * 1. handle base template
 * 2. handle whole front-end templates routing
 * 
 * */
'use strict';
var index_page_app;
(function(){
	// Angular.js
	// declare app level module which depends on filters, and services, and modify $interpolateProvider to avoid the conflict with jinja2' symbol
	index_page_app = angular.module('index_page_app', [ 'angular-responsive', 'ui.router', 'myGpsDataDirective' ], function($interpolateProvider) {
		$interpolateProvider.startSymbol('[[');
		$interpolateProvider.endSymbol(']]');
	});

	// global values
	index_page_app.value('GLOBAL_VALUES',{
		EMAIL : 'gogistics@gogistics-tw.com',
		URL_UPLOAD_IMAGE_TO_BLOB : data_backend.upload_url,
	});

	// app-routing configuration
	index_page_app.config(function(responsiveHelperProvider, $stateProvider, $urlRouterProvider) {
		// templates dispatcher which redirect visitors to appropriate templates;
		// currently, there are desktop and mobile versions
		var device = 'desktop';
		var responsiveHelper = responsiveHelperProvider.$get();
		if (responsiveHelper.isMobile()) {
			device = 'mobile';
		}
		else if(responsiveHelper.isTablet()){
			device = 'tablet';
		}
		
		// nested templates and routing
		$stateProvider
		.state('home', {
			templateUrl: '/ng_templates/my_ng_template_base.html',
		})
		.state('index_page', {
			parent: 'home',
			templateUrl: '/ng_templates/' + device + '/index.html',
			controller: 'indexPageDispatchCtrl'
		})
		.state('index_1', {
			url: '/index_1',
			parent: 'index_page',
			templateUrl: '/ng_templates/' + device + '/index_1.html',
		})
		.state('index_2', {
			url: '/index_2',
			parent: 'index_page',
			templateUrl: '/ng_templates/' + device + '/index_2.html',
		});

		$urlRouterProvider.otherwise('/index_1'); // for defualt state routing; for current routing mechanism, it's not necessary
		
	});

	/* controllers */
	// for routing to default content on index page
	var indexPageDispatchController = function ($state, $scope, GLOBAL_VALUES) {
		$scope.email = GLOBAL_VALUES.EMAIL;
		console.log($state.current.name);
		
		if($state.current.name !== 'index_1'){
		    $state.transitionTo('index_1');
		}
	}
	indexPageDispatchController.$inject = ['$state', '$scope', 'GLOBAL_VALUES'];

	// page controllers
	var myIndexController = function ($scope, GLOBAL_VALUES) {
		$scope.email = GLOBAL_VALUES.EMAIL;
		
		$scope.select_topic = function(section) {
	        $scope.selected = section;
	    }

	    $scope.is_selected = function(section) {
	        return ($scope.selected === section);
	    }
		
	    // init selected topic
	    $scope.select_topic('index_1');
	}
	myIndexController.$inject = ['$scope', 'GLOBAL_VALUES'];

	index_page_app
	.controller('indexPageDispatchCtrl', indexPageDispatchController)
	.controller('myIndexCtrl', myIndexController);
	
	//
	// ng-services of index_2
	var indexTwoService = function($http, GLOBAL_VALUES){
		console.log(GLOBAL_VALUES.URL_UPLOAD_IMAGE_TO_BLOB);
		
		this.upload_imgs = function(arg_data){
			// upload images
		}
	}
	indexTwoService.$inject = ['$http', 'GLOBAL_VALUES'];
	index_page_app.service('myIndexTwoService', indexTwoService);
	
	// ng-controllers of index_2
	indexTwoController = function(myIndexTwoService, GLOBAL_VALUES){
		this.upload_img_to_blobstore = upload_img_to_blobstore;
		var upload_img_to_blobstore = function(){
			alert('hello');
		};
	}
	indexTwoController.$inject = ['myIndexTwoService', 'GLOBAL_VALUES'];
	index_page_app.controller('myIndexTwoCtrl', indexTwoController);
	
	/* services */
	
	/* JQuery */
	
})();